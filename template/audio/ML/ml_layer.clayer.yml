layer:
  type: ML
  description: ML layer for Keyword Spotting using MicroNet ML model.

  packs:
    - pack: ARM::CMSIS-DSP@^1.16.0
    - pack: ARM::CMSIS-NN@^7.0.0

    - pack: ARM::ml-embedded-eval-kit-uc-api@^24.8.0

    - pack: tensorflow::flatbuffers@^1.25.2
    - pack: tensorflow::gemmlowp@^1.25.2
    - pack: tensorflow::kissfft@^1.25.2
    - pack: tensorflow::ruy@^1.25.2
    - pack: tensorflow::tensorflow-lite-micro@^1.25.2

  connections:
    - connect: Layer with CMSIS-RTOS2
      consumes:
        - CMSIS-RTOS2

  components:
    - component: CMSIS:DSP&Source
    - component: CMSIS:NN Lib

    - component: Data Exchange:Serialization:flatbuffers&tensorflow
    - component: Data Processing:Math:gemmlowp fixed-point&tensorflow
    - component: Data Processing:Math:kissfft&tensorflow
    - component: Data Processing:Math:ruy&tensorflow

    # TensorFlow Kernel variant for devices without Ethos-U
    - component: Machine Learning:TensorFlow:Kernel&CMSIS-NN
      not-for-context: \.*-U[0-9]{2}.*
    # TensorFlow Kernel variant for devices with Ethos-U
    - component: Machine Learning:TensorFlow:Kernel&Ethos-U
      for-context: \.*-U[0-9]{2}.*

    - component: Machine Learning:TensorFlow:Kernel Utils
    - component: Machine Learning:TensorFlow:Testing

    - component: ML Eval Kit:Common:API
    - component: ML Eval Kit:Common:Log
    - component: ML Eval Kit:Common:Math
    - component: ML Eval Kit:Voice:Keyword spotting

  add-path:
    - ./model

  groups:
    - group: Documentation - ML Layer
      files:
        - file: ./README.md

    - group: Configuration - ML Model
      files:
        - file: ./model/model_config.h

    - group: Keyword Spotting ML model - Ethos-U55 128 MACS
      for-context: \.*-U55-128.*
      files:
        # Model for devices with Ethos-U55 (128 macs)
        - file: ./model/kws_micronet_m_vela_H128.tflite.c

    - group: Keyword Spotting ML model - Ethos-U55 256 MACS
      for-context: \.*-U55(-256)?(?!-\d{2,3}).*
      files:
        # Model for devices with Ethos-U55 (256 macs)
        - file: ./model/kws_micronet_m_vela_H256.tflite.c

    - group: Keyword Spotting ML model - Ethos-U65 256 MACS
      for-context: \.*-U65(-256)?(?!-\d{2,3}).*
      files:
        # Model for devices with Ethos-U65 (256 macs)
        - file: ./model/kws_micronet_m_vela_Y256.tflite.c

    - group: Keyword Spotting ML model - Ethos-U85 256 MACS
      for-context: \.*-U85(-256)?(?!-\d{2,3}).*
      files:
        # Model for devices with Ethos-U85 (256 macs)
        - file: ./model/kws_micronet_m_vela_Z256.tflite.c

    - group: Keyword Spotting ML model - no Ethos-U
      not-for-context: \.*-U[0-9]{2}.*
      files:
        # Model for devices without Ethos-U
        - file: ./model/kws_micronet_m.tflite.c
